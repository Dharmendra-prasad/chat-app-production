(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{42:function(e,t,n){},43:function(e,t,n){},53:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){"use strict";n.r(t);var a=n(2),c=n.n(a),r=n(28),s=n.n(r),i=(n(42),n.p,n(43),n(23)),o=n(9),u=n(18),l=n(12),d=n(14),j=n.n(d),b=n(21),p=n(16),f="USER_LOGIN",h="USER_LOGOUT",O="GET_REALTIME_USERS",m="GET_REALTIME_MESSAGES",g=n(11),v=(n(53),n(3)),x=function(e){var t=Object(l.c)((function(e){return e.auth})),n=Object(l.b)();return Object(v.jsxs)("header",{className:"header",children:[Object(v.jsxs)("div",{style:{display:"flex"},children:[Object(v.jsx)("div",{className:"logo",children:"Web Messenger"}),t.authenticated?null:Object(v.jsxs)("ul",{className:"leftMenu",children:[Object(v.jsx)("li",{children:Object(v.jsx)(i.c,{to:"/login",children:"Login"})}),Object(v.jsx)("li",{children:Object(v.jsx)(i.c,{to:"/signup",children:"Sign up"})})]})]}),Object(v.jsx)("div",{style:{margin:"20px 0",color:"#fff",fontWeight:"bold"},children:t.authenticated?"".concat(t.firstName," ").concat(t.lastName):""}),Object(v.jsx)("ul",{className:"menu",children:t.authenticated?Object(v.jsx)("li",{children:Object(v.jsx)(i.b,{to:"#",onClick:function(){var e;n((e=t.uid,function(){var t=Object(b.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n({type:"".concat(h,"_REQUEST")}),p.a.firestore().collection("users").doc(e).update({isOnline:!1}).then((function(){p.a.auth().signOut().then((function(){localStorage.clear(),n({type:"".concat(h,"_SUCCESS")})})).catch((function(e){console.log(e),n({type:"".concat(h,"_FAILURE"),payload:{error:e}})}))})).catch((function(e){console.log(e)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))},children:"Logout"})}):null})]})},S=function(e){return Object(v.jsxs)("div",{children:[Object(v.jsx)(x,{}),e.children]})},y=(n(56),function(e){var t=e.user,n=e.onClick;return Object(v.jsxs)("div",{onClick:function(){return n(t)},className:"displayName",children:[Object(v.jsx)("div",{className:"displayPic",children:Object(v.jsx)("img",{src:"https://i.pinimg.com/originals/be/ac/96/beac96b8e13d2198fd4bb1d5ef56cdcf.jpg",alt:""})}),Object(v.jsxs)("div",{style:{display:"flex",flex:1,justifyContent:"space-between",margin:"0 10px"},children:[Object(v.jsxs)("span",{style:{fontWeight:500},children:[t.firstName," ",t.lastName]}),Object(v.jsx)("span",{className:t.isOnline?"onlineStatus":"onlineStatus off"})]})]},t.uid)}),N=function(e){var t,n=Object(l.b)(),c=Object(l.c)((function(e){return e.auth})),r=Object(l.c)((function(e){return e.user})),s=Object(a.useState)(!1),i=Object(u.a)(s,2),o=i[0],d=i[1],f=Object(a.useState)(""),h=Object(u.a)(f,2),x=h[0],N=h[1],_=Object(a.useState)(""),E=Object(u.a)(_,2),w=E[0],C=E[1],U=Object(a.useState)(null),I=Object(u.a)(U,2),k=I[0],A=I[1];Object(a.useEffect)((function(){var e;t=n((e=c.uid,function(){var t=Object(b.a)(j.a.mark((function t(n){var a,c;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n({type:"".concat(O,"_REQUEST")}),a=p.a.firestore(),c=a.collection("users").onSnapshot((function(t){var a=[];t.forEach((function(t){t.data().uid!=e&&a.push(t.data())})),n({type:"".concat(O,"_SUCCESS"),payload:{users:a}})})),t.abrupt("return",c);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())).then((function(e){return e})).catch((function(e){console.log(e)}))}),[]),Object(a.useEffect)((function(){return function(){t.then((function(e){return e()})).catch((function(e){return console.log(e)}))}}),[]);var R=function(e){d(!0),N("".concat(e.firstName," ").concat(e.lastName)),A(e.uid),console.log(e),n(function(e){return function(){var t=Object(b.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p.a.firestore().collection("conversations").where("user_uid_1","in",[e.uid_1,e.uid_2]).orderBy("createdAt","asc").onSnapshot((function(t){var a=[];t.forEach((function(t){(t.data().user_uid_1==e.uid_1&&t.data().user_uid_2==e.uid_2||t.data().user_uid_1==e.uid_2&&t.data().user_uid_2==e.uid_1)&&a.push(t.data()),a.length>0?n({type:m,payload:{conversations:a}}):n({type:"".concat(m,"_FAILURE"),payload:{conversations:a}})})),console.log(a)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}({uid_1:c.uid,uid_2:e.uid}))};return Object(v.jsx)(S,{children:Object(v.jsxs)("section",{className:"container",children:[Object(v.jsx)("div",{className:"listOfUsers",children:r.users.length>0?r.users.map((function(e){return Object(v.jsx)(y,{onClick:R,user:e},e.uid)})):null}),Object(v.jsxs)("div",{className:"chatArea",children:[Object(v.jsx)("div",{className:"chatHeader",children:o?x:""}),Object(v.jsx)("div",{className:"messageSections",children:o?r.conversations.map((function(e){return Object(v.jsx)("div",{style:{textAlign:e.user_uid_1==c.uid?"right":"left"},children:Object(v.jsx)("p",{className:"messageStyle",children:e.message})})})):null}),o?Object(v.jsxs)("div",{className:"chatControls",children:[Object(v.jsx)("textarea",{value:w,onChange:function(e){return C(e.target.value)},placeholder:"Write message"}),Object(v.jsx)("button",{onClick:function(e){var t={user_uid_1:c.uid,user_uid_2:k,message:w};""!==w&&n(function(e){return function(){var t=Object(b.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p.a.firestore().collection("conversations").add(Object(g.a)(Object(g.a)({},e),{},{isView:!1,createdAt:new Date})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(t)).then((function(){C("")}))},children:"Send"})]}):null]})]})})},_=(n(57),function(e){return Object(v.jsxs)("div",{className:"card",children:["Card",e.children]})}),E=(n(58),function(e){var t=Object(a.useState)(""),n=Object(u.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)(""),i=Object(u.a)(s,2),d=i[0],h=i[1],O=Object(l.b)();return Object(l.c)((function(e){return e.auth})).authenticated?Object(v.jsx)(o.a,{to:"/"}):Object(v.jsx)(S,{children:Object(v.jsx)("div",{className:"loginContainer",children:Object(v.jsx)(_,{children:Object(v.jsxs)("form",{onSubmit:function(e){var t;(e.preventDefault(),""!=c)?""!=d?O((t={email:c,password:d},function(){var e=Object(b.a)(j.a.mark((function e(n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:"".concat(f,"_REQUEST")}),p.a.auth().signInWithEmailAndPassword(t.email,t.password).then((function(e){console.log(e),p.a.firestore().collection("users").doc(e.user.uid).update({isOnline:!0}).then((function(){var t=e.user.displayName.split(" "),a={firstName:t[0],lastName:t[1],uid:e.user.uid,email:e.user.email};localStorage.setItem("user",JSON.stringify(a)),n({type:"".concat(f,"_SUCCESS"),payload:{user:a}})})).catch((function(e){console.log(e),n({type:"".concat(f,"_FAILURE"),payload:{error:e}})})).catch((function(e){console.log(e)}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())):alert("password is required"):alert("email is required")},children:[Object(v.jsx)("input",{name:"email",type:"text",value:c,onChange:function(e){return r(e.target.value)},placeholder:"Email"}),Object(v.jsx)("input",{name:"password",type:"password",value:d,onChange:function(e){return h(e.target.value)},placeholder:"Password"}),Object(v.jsx)("div",{children:Object(v.jsx)("button",{children:"Login"})})]})})})})}),w=function(e){var t=Object(a.useState)(""),n=Object(u.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)(""),i=Object(u.a)(s,2),d=i[0],h=i[1],O=Object(a.useState)(""),m=Object(u.a)(O,2),g=m[0],x=m[1],y=Object(a.useState)(""),N=Object(u.a)(y,2),E=N[0],w=N[1],C=Object(l.b)();return Object(l.c)((function(e){return e.auth})).authenticated?Object(v.jsx)(o.a,{to:"/"}):Object(v.jsx)(S,{children:Object(v.jsx)("div",{className:"registerContainer",children:Object(v.jsx)(_,{children:Object(v.jsxs)("form",{onSubmit:function(e){e.preventDefault(),C(function(e){return function(){var t=Object(b.a)(j.a.mark((function t(n){var a;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=p.a.firestore(),n({type:"".concat(f,"_REQUEST")}),p.a.auth().createUserWithEmailAndPassword(e.email,e.password).then((function(t){console.log(t);var c=p.a.auth().currentUser,r="".concat(e.firstName," ").concat(e.lastName);c.updateProfile({displayName:r}).then((function(){a.collection("users").doc(t.user.uid).set({firstName:e.firstName,lastName:e.lastName,uid:t.user.uid,createdAt:new Date,isOnline:!0}).then((function(){var a={firstName:e.firstName,lastName:e.lastName,uid:t.user.uid,email:e.email};localStorage.setItem("user",JSON.stringify(a)),console.log("user successfully loggedin"),n({type:"".concat(f,"_SUCCESS"),payload:{user:a}})})).catch((function(e){console.log(e),n({type:"".concat(f,"_FAILURE"),payload:{error:e}})}))}))})).catch((function(e){console.log(e)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}({firstName:c,lastName:d,email:g,password:E}))},children:[Object(v.jsx)("h2",{children:"Signup"}),Object(v.jsx)("input",{name:"firstName",type:"text",value:c,onChange:function(e){return r(e.target.value)},placeholder:"First Name"}),Object(v.jsx)("input",{name:"lastName",type:"text",value:d,onChange:function(e){return h(e.target.value)},placeholder:"Last Name"}),Object(v.jsx)("input",{name:"email",type:"text",value:g,onChange:function(e){return x(e.target.value)},placeholder:"Email"}),Object(v.jsx)("input",{name:"password",type:"password",value:E,onChange:function(e){return w(e.target.value)},placeholder:"Password"}),Object(v.jsx)("div",{children:Object(v.jsx)("button",{children:"Sign up"})})]})})})})},C=n(37),U=function(e){var t=e.component,n=Object(C.a)(e,["component"]);return Object(v.jsx)("div",{children:Object(v.jsx)(o.b,Object(g.a)(Object(g.a)({},n),{},{component:function(e){return(localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null)?Object(v.jsx)(t,Object(g.a)({},e)):Object(v.jsx)(o.a,{to:"/login"})}}))})};var I=function(){var e=Object(l.c)((function(e){return e.auth})),t=Object(l.b)();return Object(a.useEffect)((function(){e.authenticated||t(function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null,t(n?{type:"".concat(f,"_SUCCESS"),payload:{user:n}}:{type:"".concat(f,"_FAILURE"),payload:{error:"login again please"}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),Object(v.jsx)("div",{className:"App",children:Object(v.jsxs)(i.a,{children:[Object(v.jsx)(U,{path:"/",exact:!0,component:N}),Object(v.jsx)(o.b,{path:"/login",exact:!0,component:E}),Object(v.jsx)(o.b,{path:"/signup",exact:!0,component:w})]})})},k=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,60)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),a(e),c(e),r(e),s(e)}))},A=n(26),R=n(36),L={firstName:"",lastName:"",email:"",authenticating:!1,authenticated:!1,error:null},T={users:[],conversations:[]},F=Object(A.b)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0;switch(console.log(t),t.type){case"".concat(f,"_REQUEST"):e=Object(g.a)(Object(g.a)({},e),{},{authenticating:!0});break;case"".concat(f,"_SUCCESS"):e=Object(g.a)(Object(g.a)(Object(g.a)({},e),t.payload.user),{},{authenticated:!0,authenticating:!1});break;case"".concat(f,"_FAILURE"):e=Object(g.a)(Object(g.a)({},e),{},{authenticated:!1,authenticating:!1,error:t.payload.error});break;case"".concat(h,"_REQUEST"):break;case"".concat(h,"_SUCCESS"):e=Object(g.a)({},L);break;case"".concat(h,"_FAILURE"):e=Object(g.a)(Object(g.a)({},e),{},{error:t.payload.error})}return e},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"".concat(O,"_REQUEST"):break;case"".concat(O,"_SUCCESS"):e=Object(g.a)(Object(g.a)({},e),{},{users:t.payload.users});break;case m:e=Object(g.a)(Object(g.a)({},e),{},{conversations:t.payload.conversations})}return e}}),M=Object(A.c)(F,Object(A.a)(R.a));p.a.initializeApp({apiKey:"AIzaSyBiTv1ME3rpc4oIx3szHKJrBHLnwA8MXYM",authDomain:"chat-app-eb739.firebaseapp.com",projectId:"chat-app-eb739",storageBucket:"chat-app-eb739.appspot.com",messagingSenderId:"564946443399",appId:"1:564946443399:web:03ab6d68c784a5dfedec22",measurementId:"G-WQY11K1QFB"}),window.store=M,s.a.render(Object(v.jsx)(l.a,{store:M,children:Object(v.jsx)(c.a.StrictMode,{children:Object(v.jsx)(I,{})})}),document.getElementById("root")),k()}},[[59,1,2]]]);
//# sourceMappingURL=main.1401e80c.chunk.js.map